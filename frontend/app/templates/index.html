<!DOCTYPE html>
<html lang="en">
<head>
    {% block head %}
    <title>{% block title %}Frontend{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
          integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
          crossorigin="anonymous">

    <!-- Leaflet CSS -->
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin="anonymous">

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
    {% endblock %}
</head>
<body>
    {% block body %}
    <div class="container-fluid">
        <nav class="navbar navbar-expand-md navbar-light bg-light">
            <a class="navbar-brand" href="/">Ashlar Public Frontend</a>
        </nav>
        <div class="row">
            <div id="map"></div>
        </div>
    </div>
    {% endblock %}

    <!-- Load Babel polyfill for ES6 support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Load JQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>

    <!-- Load Popper (Bootstrap dependency) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
            integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
            crossorigin="anonymous"></script>

    <!-- Load Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
            integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
            crossorigin="anonymous"></script>

    <!-- Load Leaflet -->
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
            integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
            crossorigin="anonymous"></script>

    <!-- Extra JS files -->
    {% block extra_js %}
    <script type="text/babel">
        $(() => {
            // Make map fullscreen
            $(window).resize(() => {
                let windowHeight = $(window).outerHeight();
                let offsetTop = $('.navbar').height(); // Calculate the top offset

                let mapHeight = windowHeight - offsetTop;
                $('#map').css('height', mapHeight);
            }).resize();

            // Initialize a map
            var map = new L.map('map', {
                center: [40.01, -75.13],
                zoom: 9,
                dragging: true,
                touchZoom: true,
                tap: true,
                scrollWheelZoom: false
            });

            // Add tile layer from OSM
            var tiles = new L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> Contributors',
                maxZoom: 18,
            }).addTo(map);

            const apiUrl = 'http://127.0.0.1:8000/api';

            // Display all records on the map
            $.getJSON(`${apiUrl}/records/`)
                .done((data) => {
                    let records = data.results;
                    if (records) {
                        for (let record of records) {
                            let coords = record.geom.coordinates;
                            let lat = coords[0],
                                lng = coords[1];
                            console.log([lng, lat]);
                        }
                    } else {
                        console.log('No records found');
                    }
              }).fail((err) => {
                    console.log(err);
              })
        });
    </script>
    {% endblock %}
</body>

</html>
